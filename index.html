<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NIFTY MACD Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    background:#0a0a0a;
    color:white;
    font-family:sans-serif;
    padding:10px;
}
h1 { text-align:center; }
.grid {
    display:grid;
    grid-template-columns:1fr;
    gap:20px;
}
.card {
    background:#1a1a1a;
    border-radius:12px;
    padding:15px;
}
.buy { border:2px solid #00ff88; }
.sell { border:2px solid #ff4444; }

@media(min-width:768px){
    .grid { grid-template-columns:1fr 1fr; }
}
</style>
</head>

<body>

<h1>ðŸš€ NIFTY Options MACD</h1>

<div class="grid">
    <div class="card buy">
        <h2 id="callTitle">ðŸ“ˆ CALL</h2>
        <canvas id="callChart"></canvas>
    </div>

    <div class="card sell">
        <h2 id="putTitle">ðŸ“‰ PUT</h2>
        <canvas id="putChart"></canvas>
    </div>
</div>

<div style="text-align:center;margin-top:10px">
    Last update: <span id="timestamp">--</span>
</div>

<script>
const ws = new WebSocket(
    (location.protocol === "https:" ? "wss://" : "ws://") +
    location.host + "/ws"
);

let callChart, putChart;

ws.onmessage = (event) => {
    const d = JSON.parse(event.data);

    document.getElementById("timestamp").innerText = d.timestamp;
    document.getElementById("callTitle").innerText =
        `ðŸ“ˆ CALL ${d.call.strike} | ${d.call.signal}`;
    document.getElementById("putTitle").innerText =
        `ðŸ“‰ PUT ${d.put.strike} | ${d.put.signal}`;

    // ---- CALL CHART ----
    if (!callChart) {
        callChart = new Chart(document.getElementById("callChart"), {
            type: 'line',
            data: {
                labels: d.call.labels,
                datasets: [
                    {
                        label: 'Price',
                        data: d.call.price,
                        borderWidth: 2
                    },
                    {
                        label: 'MACD',
                        data: d.call.macd,
                        borderWidth: 2
                    }
                ]
            }
        });
    } else {
        callChart.data.labels = d.call.labels;
        callChart.data.datasets[0].data = d.call.price;
        callChart.data.datasets[1].data = d.call.macd;
        callChart.update();
    }

    // ---- PUT CHART ----
    if (!putChart) {
        putChart = new Chart(document.getElementById("putChart"), {
            type: 'line',
            data: {
                labels: d.put.labels,
                datasets: [
                    {
                        label: 'Price',
                        data: d.put.price,
                        borderWidth: 2
                    },
                    {
                        label: 'MACD',
                        data: d.put.macd,
                        borderWidth: 2
                    }
                ]
            }
        });
    } else {
        putChart.data.labels = d.put.labels;
        putChart.data.datasets[0].data = d.put.price;
        putChart.data.datasets[1].data = d.put.macd;
        putChart.update();
    }
};
</script>

</body>
</html>
