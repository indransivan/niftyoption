<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NIFTY MACD Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: sans-serif; background:#0a0a0a; color:white; padding:15px }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:15px }
.card { padding:20px; border-radius:12px; text-align:center; }
.buy { background:#00ff8840; border:2px solid #00ff88; }
.sell { background:#ff444440; border:2px solid #ff4444; }
</style>
</head>
<body>

<h1>ðŸš€ NIFTY Options MACD Dashboard</h1>
<div class="grid" id="signals"></div>
<div>Last update: <span id="timestamp"></span></div>

<canvas id="callChart" height="300"></canvas>
<canvas id="putChart" height="300"></canvas>

<script>
let callChart, putChart;

const ws = new WebSocket(
    (location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/ws"
);

ws.onmessage = (event) => {
    const d = JSON.parse(event.data);

    // Update signals
    document.getElementById("signals").innerHTML = `
        <div class="card buy">
            <h2>ðŸ“ˆ CALL ${d.call.strike}</h2>
            <h1>ATM</h1>
        </div>
        <div class="card sell">
            <h2>ðŸ“‰ PUT ${d.put.strike}</h2>
            <h1>ATM</h1>
        </div>
    `;
    document.getElementById("timestamp").innerText = d.timestamp;

    // Prepare candlestick data
    const callData = d.call.candles.map(c => ({
        x: new Date(c.time),
        o: c.open, h: c.high, l: c.low, c: c.close
    }));
    const putData = d.put.candles.map(c => ({
        x: new Date(c.time),
        o: c.open, h: c.high, l: c.low, c: c.close
    }));

    const chartOptions = {
        type: 'candlestick',
        data: { datasets: [{ label:'Candles', data: [] }] },
        options: { plugins: { legend: { display:false } } }
    };

    if (!callChart) {
        callChart = new Chart(document.getElementById('callChart'), {
            type:'candlestick',
            data: { datasets:[{ label:'CALL', data: callData }] },
            options: { plugins:{ legend:{ display:false } } }
        });
    } else {
        callChart.data.datasets[0].data = callData;
        callChart.update();
    }

    if (!putChart) {
        putChart = new Chart(document.getElementById('putChart'), {
            type:'candlestick',
            data: { datasets:[{ label:'PUT', data: putData }] },
            options: { plugins:{ legend:{ display:false } } }
        });
    } else {
        putChart.data.datasets[0].data = putData;
        putChart.update();
    }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.0.0/dist/chartjs-chart-financial.min.js"></script>
</body>
</html>
