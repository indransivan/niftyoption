<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NIFTY MACD Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.1.0/dist/chartjs-chart-financial.min.js"></script>
<style>
body { font-family: sans-serif; background:#111; color:white; margin:20px }
canvas { background:#000; margin-bottom:40px; border-radius:10px; }
.signal { font-size:18px; font-weight:bold; margin:5px; }
.buy { color:#00ff88; }
.sell { color:#ff4444; }
.hold { color:#ffaa00; }
</style>
</head>
<body>
<h1>ðŸš€ NIFTY Options MACD Dashboard</h1>
<div>Last update: <span id="timestamp">--:--</span></div>
<div class="signal">CALL: <span id="call_signal">--</span></div>
<div class="signal">PUT: <span id="put_signal">--</span></div>

<canvas id="callChart" width="800" height="400"></canvas>
<canvas id="putChart" width="800" height="400"></canvas>

<script>
const callCtx = document.getElementById('callChart').getContext('2d');
const putCtx = document.getElementById('putChart').getContext('2d');

let callChart = new Chart(callCtx, {
    type: 'candlestick',
    data: { datasets: [{ label: 'CALL', data: [] }] },
    options: { plugins: { legend:{display:true} }, scales: { x:{type:'time'}, y:{beginAtZero:false} } }
});

let putChart = new Chart(putCtx, {
    type: 'candlestick',
    data: { datasets: [{ label: 'PUT', data: [] }] },
    options: { plugins: { legend:{display:true} }, scales: { x:{type:'time'}, y:{beginAtZero:false} } }
});

const ws = new WebSocket((location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/ws");

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if(data.error) {
        console.error(data.error);
        return;
    }

    document.getElementById('timestamp').innerText = data.timestamp;
    document.getElementById('call_signal').innerText = data.call_signal;
    document.getElementById('put_signal').innerText = data.put_signal;

    // NOTE: For simplicity, real candlestick data not streamed yet. Can add Breeze historical candles here
};
</script>
</body>
</html>
